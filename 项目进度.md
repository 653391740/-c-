# 严选商城 C 端项目进度记录

## 项目概述

- **项目名称**: 严选商城 C 端
- **版本**: 1.0.0
- **技术栈**: Vue 2.7.16 + Vite 4.5.0 + SCSS
- **开发状态**: 初期开发阶段

## 项目结构

```
严选商城C端/
├── src/
│   ├── App.vue          # 主应用组件
│   ├── main.js          # 入口文件
│   ├── router/          # 路由配置
│   │   └── index.js
│   ├── api/             # API接口
│   │   └── home.js
│   ├── utils/           # 工具函数
│   │   └── request.js
│   ├── components/      # 通用组件
│   │   ├── title.vue
│   │   └── goodslist.vue
│   ├── views/           # 页面组件
│   │   ├── index/       # 布局组件
│   │   │   ├── index.vue
│   │   │   └── Footer.vue
│   │   ├── home/        # 首页
│   │   │   ├── index.vue
│   │   │   ├── banner.vue
│   │   │   ├── head.vue
│   │   │   ├── nav.vue
│   │   │   └── tuijian.vue
│   │   ├── cate/        # 分类页
│   │   │   └── index.vue
│   │   ├── cart/        # 购物车
│   │   │   └── index.vue
│   │   ├── user/        # 用户中心
│   │   │   └── index.vue
│   │   ├── login.vue    # 登录页
│   │   └── goodlist.vue # 商品列表页
│   └── assets/          # 静态资源
└── ...
```

## 已完成功能

### 1. 基础架构

- ✅ Vue 2.7.16 框架搭建
- ✅ Vite 构建工具配置
- ✅ 项目目录结构设计
- ✅ 入口文件配置(main.js)
- ✅ 主应用组件配置(App.vue)
- ✅ 全局样式引入
- ✅ 图标字体引入

### 2. 路由配置

- ✅ 路由基础配置
- ✅ 首页路由(/)
- ✅ 分类路由(/cate)
- ✅ 购物车路由(/cart)
- ✅ 用户中心路由(/user)
- ✅ 登录页路由(/login)
- ✅ 商品列表路由(/goodslist)
- ✅ 订单确认页路由(/orderconfirm)
- ✅ 地址列表页路由(/addresslist)
- ✅ 订单列表页路由(/orderlist)
- ✅ 路由白名单配置
- ✅ 路由重定向配置
- ✅ 路由守卫配置

### 3. 首页模块 (/home)

- ✅ 轮播图组件 (components/banner.vue)
- ✅ 头部搜索和分类导航
- ✅ 导航菜单
- ✅ 推荐商品展示
- ✅ 热门商品列表

### 4. 商品列表模块 (/goodslist)

- ✅ 商品列表页面
- ✅ 搜索框
- ✅ 排序功能
- ✅ 筛选功能
- ✅ 滚动加载

### 5. 分类页模块 (/cate)

- ✅ 分类侧边栏 (views/cate/aside.vue)
- ✅ 分类商品列表 (views/cate/select\_\_content.vue)
- ✅ 分类筛选功能
- ✅ 分类排序功能

### 6. 购物车模块 (/cart)

- ✅ 购物车商品列表 (views/cart/cart.vue)
- ✅ 商品数量调整
- ✅ 商品选择/取消选择
- ✅ 购物车商品总价计算
- ✅ 结算功能 (views/cart/orderconfirm.vue)
- ✅ 购物车空状态处理
- ✅ 购物车商品滑动删除
- ✅ 购物车商品编辑
- ✅ 购物车商品删除

### 7. 用户中心模块 (/user)

- ✅ 用户信息展示 (views/user/head-user.vue)
- ✅ 订单管理 (views/orderlist.vue)
- ✅ 地址管理 (views/addresslist.vue)
- ✅ 用户资源详情 (views/user/resDetail.vue)
- ✅ 用户信息编辑 (views/user/useredit.vue)
- ✅ 日历组件 (views/user/calendar.vue)
- ✅ 区域选择组件 (views/user/region.vue)

### 8. 登录模块 (/login)

- ✅ 登录主页面 (views/login/login.vue)
- ✅ 账号密码登录表单 (views/login/formlogin.vue)
- ✅ 表单验证
- ✅ 登录接口调用
- ✅ Token 存储与管理
- ✅ 登录状态维护
- ✅ 短信验证码登录 (views/login/smslogin.vue)
- ✅ 用户注册 (views/login/register.vue)
- ✅ 获取用户信息

### 9. API 接口模块

- ✅ 登录相关接口 (api/login.js)
- ✅ 账号密码登录
- ✅ 发送短信验证码
- ✅ 短信验证码登录
- ✅ 用户注册
- ✅ 获取用户信息
- ✅ 首页相关接口 (api/home.js)
- ✅ 登录接口
- ✅ 分类接口
- ✅ 轮播图接口
- ✅ 热门商品接口
- ✅ 商品列表接口
- ✅ 购物车相关接口 (api/cart.js)
- ✅ 购物车商品列表
- ✅ 加入购物车
- ✅ 购物车商品编辑
- ✅ 购物车商品删除
- ✅ 地址列表
- ✅ 订单列表

### 10. 网络请求模块

- ✅ 请求实例创建 (utils/request.js)
- ✅ 请求拦截器配置
- ✅ 响应拦截器配置
- ✅ 错误处理机制
- ✅ 超时处理

### 11. 通用组件模块

- ✅ 标题栏组件 (components/title.vue)
- ✅ 商品列表组件 (components/goodslist.vue)
- ✅ 弹窗组件 (components/Popup.vue)
- ✅ 输入框组件 (components/input.vue)
- ✅ 订单组件 (components/dingdan.vue)
- ✅ 消息提示组件 (components/msg.vue)
- ✅ 弹出消息组件 (components/popupmsg.vue)
- ✅ 组件全局注册 (components/index.js)

### 12. 通用功能

- ✅ 网络请求封装 (utils/request.js)
- ✅ API 接口封装 (api/home.js, api/login.js, api/cart.js)
- ✅ 通用组件 (components/title.vue, components/goodslist.vue 等)
- ✅ 错误处理
- ✅ 加载状态管理
- ✅ 消息提示功能
- ✅ 弹窗功能
- ✅ 表单验证功能
- ✅ 滑动删除功能
- ✅ 本地存储管理

## 待完成功能

### 1. 首页模块 (/home)

- ❌ 搜索功能

### 2. 商品详情模块 (/gooddesc)

- ✅ 商品详情页面
- ✅ 商品图片展示
- ✅ 商品信息展示
- ✅ 商品规格选择
- ✅ 加入购物车
- ❌ 立即购买

### 3. 通用功能

- ✅ 数据持久化
- ❌ 响应式布局适配
- ❌ 退出登录功能
- ❌ 支付功能

## 开发计划

### 第一阶段：基础功能完善

1. 完成基本页面样式

### 第二阶段：核心功能开发

1. 完成登录一系列功能
2. 数据 api 接口调用页面数据展示
3. 接口封装

### 第三阶段：功能完善优化

1. 性能优化
2. 功能测试
3. 用户体验优化

### 大体

- 项目目前处于中期开发阶段，主要功能模块已基本实现
- 首页模块已实现轮播图、头部导航、导航菜单、推荐商品和热门商品列表
- 商品列表页面已实现搜索框、排序功能、筛选功能和滚动加载
- 分类页模块已实现分类侧边栏、分类商品列表、分类筛选和排序功能
- 购物车模块已实现购物车商品列表、商品数量调整、商品选择、总价计算、结算功能、滑动删除等
- 用户中心模块已实现用户信息展示、订单管理、地址管理、用户资源详情等功能
- 登录模块已实现账号密码登录、短信验证码登录、用户注册、表单验证等功能
- API 接口和网络请求模块已基本完成，包括登录相关接口、首页相关接口和购物车相关接口
- 通用组件模块已实现标题栏、商品列表、弹窗、输入框、订单组件、消息提示等多种组件
- 需要进一步实现商品详情页面、收藏商品、浏览历史、商品评价、支付功能等高级功能

# 最后更新时间

2023 年 11 月 15 日

## 遇到的问题

### 1. 技术选型问题

- **问题描述**: 在 Vue 2 和 Vue 3 之间进行选择时，考虑到项目兼容性和团队熟悉度，最终选择了 Vue 2.7.16 版本。
- **解决方案**: 使用 Vue 2.7.16 版本，该版本兼容 Vue 2 的 API 同时引入了部分 Vue 3 的特性，为将来可能的升级做准备。

### 2. 构建工具选择

- **问题描述**: 在 Webpack 和 Vite 之间进行选择时，考虑到开发体验和构建速度。
- **解决方案**: 选择 Vite 作为构建工具，利用其快速的热更新和构建速度提升开发效率。

### 3. 路由守卫配置

- **问题描述**: 在配置路由守卫时，需要处理未登录用户的访问权限问题。
- **解决方案**: 设置白名单路由，未登录用户只能访问白名单中的路由，其他路由需要登录后才能访问。

### 4. 底部导航栏状态管理

- **问题描述**: 底部导航栏需要根据当前路由高亮显示对应项，同时用户中心需要根据登录状态显示不同文本。
- **解决方案**: 使用 activeIndex 变量控制高亮状态，通过判断 token 是否存在来动态显示用户中心文本。

### 5. 页面组件结构设计

- **问题描述**: 如何设计页面组件结构以实现底部导航栏固定，内容区域可滚动的效果。
- **解决方案**: 在 App.vue 中设置 padding-bottom 为底部导航栏高度，内容区域可滚动，底部导航栏使用 fixed 定位。

### 6. 图标字体引入

- **问题描述**: 需要在项目中引入图标字体，但不确定最佳实践。
- **解决方案**: 使用 iconfont 图标字体，通过@font-face 引入，并定义对应的 class 类名。

### 7. 网络请求封装

- **问题描述**: 需要封装网络请求模块，处理请求拦截、响应拦截、错误处理等。
- **解决方案**: 计划基于 axios 封装 request 模块，统一处理请求头、token、错误处理等。

### 8. 商品列表滚动加载问题

- **问题描述**: 在 goodslist.vue 组件中，滚动加载功能存在问题。第 86 行的条件判断`if (this.params && !this.loading)`应该放在滚动事件监听内部，而不是外部。目前只有开始触发一下，导致一直滚动不刷新。

- **问题原因**: 滚动事件监听没有进行条件判断，导致每次滚动都会触发 loadmore 方法，而 loadmore 方法内部虽然有条件判断，但无法阻止滚动事件的频繁触发。

- **解决方案**: 将条件判断`if (this.params && !this.loading)`移到滚动事件监听内部，确保在滚动事件触发时先进行条件判断，避免不必要的性能消耗和错误触发。

- **代码修改建议**:
  
  ```javascript
  // 修改前
  if (this.params && !this.loading) {
      window.addEventListener("scroll", () => {
          this.loadmore();
      });
  }
  
  // 修改后
  window.addEventListener("scroll", () => {
      if (this.params && !this.loading) {
          this.loadmore();
      }
  });
  ```

### 9. 购物车页面上下滑动触发左右滑动问题

- **问题描述**: 在购物车页面（cart.vue）中，用户上下滑动浏览商品时左滑动会显示删除按钮，导致用户体验不佳。

- **问题原因**: 原始代码中，购物车商品的滑动删除功能没有区分什么时候展开，导致上下滑动偏左方向的滑动会拉出删除按钮。

- **解决方案**: 通过添加滑动方向判断机制，准确区分用户的上下滑动和左右滑动意图，只有明显的水平滑动才会触发删除功能。

- **具体实现步骤**:
  
  1. 在 data 中添加了`slideDirection`变量来记录滑动方向
  2. 添加了`startY`和`moveY`变量来记录垂直方向的滑动距离
  3. 在`touchstart`方法中记录初始的 X 和 Y 坐标，并初始化`slideDirection`为 null
  4. 在`touchmove`方法中计算水平和垂直方向的滑动距离，首次滑动时判断滑动方向：如果水平滑动距离大于垂直滑动距离，则设置为水平滑动；否则设置为垂直滑动。只有当`slideDirection`为'horizontal'时才处理左右滑动操作
  5. 在`touchend`方法中，只有当`slideDirection`为'horizontal'时才处理滑动结束的逻辑，并增加了滑动阈值（10px），避免微小误触

- **代码修改要点**:
  
  ```javascript
  // data中添加变量
  data() {
      return {
          // ...原有变量
          startY: 0,
          moveY: 0,
          slideDirection: null
      }
  }
  
  // touchstart方法
  touchstart(e, i) {
      // ...原有代码
      this.startY = e.touches[0].clientY
      this.slideDirection = null
  }
  
  // touchmove方法
  touchmove(e, i) {
      this.moveX = e.changedTouches[0].clientX
      this.moveY = e.changedTouches[0].clientY
  
      const deltaX = this.moveX - this.startX
      const deltaY = this.moveY - this.startY
  
      if (this.slideDirection === null) {
          if (Math.abs(deltaX) > Math.abs(deltaY)) {
              this.slideDirection = 'horizontal'
          } else {
              this.slideDirection = 'vertical'
          }
      }
  
      if (this.slideDirection === 'horizontal') {
          // 处理水平滑动
      }
  }
  
  // touchend方法
  touchend(e, i) {
      if (this.slideDirection === 'horizontal') {
          // 处理水平滑动结束逻辑
      }
  }
  ```

- **实现效果**: 通过这种方式，系统能够准确区分用户的上下滑动和左右滑动意图，当用户上下滑动浏览商品时不会触发删除操作，只有明显的水平滑动才会触发删除功能，提升了用户体验，减少了误操作。

### 10. 地区选择器遮罩层阻止滚动问题

- **问题描述**: 在地区选择器组件（region.vue）中，遮罩层（.pop）覆盖在内容上，导致无法滚动下方内容。

- **问题原因**: 遮罩层使用了绝对定位覆盖在整个选择器上，虽然没有设置背景色，但由于没有设置 pointer-events 属性，导致鼠标/触摸事件被遮罩层拦截，无法传递到下方的可滚动区域。

- **解决方案**: 给遮罩层（.pop）添加`pointer-events: none`属性，使鼠标/触摸事件能够穿透遮罩层，传递到下方的可滚动区域，从而允许用户正常滚动选择地区。

- **代码修改**:
  
  ```css
  .pop {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: linear-gradient(
          #ffffff,
          transparent calc(50% - 22px),
          transparent calc(50% + 22px),
          #fff
      );
      z-index: 1;
      pointer-events: none; /* 添加这行，使事件能够穿透遮罩层 */
  }
  ```

- **实现效果**: 通过添加`pointer-events: none`属性，遮罩层不再拦截鼠标/触摸事件，用户可以正常滚动选择地区，同时保持了遮罩层的视觉效果。
